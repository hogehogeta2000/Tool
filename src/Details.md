## 【進捗状況】

- **機能未実装項目**
  - 各承認・点検ステップにおける「差し戻し」機能は未実装。
  - 差し戻し時・承認時などの各アクションにおける**通知先設定（Power Automateを含む）も未実装**。
  - 「点検」機能において、承認申請のカテゴリに応じて出力すべき項目群が存在するが、**その元設定（マスタ情報など）の構築が未完了**。

---

## 【UAT実施に向けた準備事項】

1. **アプリのデプロイ**
   - 開発環境（`Dev-Siryou`）にあるアプリを**最新状態で保存**し、**Power Platform パイプラインを実行**して `Test-Siryou` 環境へ反映させる。

2. **ユーザー権限の確認**
   - `Test-Siryou` 環境にて、UATに参加予定のユーザーが**適切なセキュリティロール（Dataverse上のロールなど）を付与されているか確認**する。
   - Power Apps アプリへのアクセス可否、データ編集可否をロールベースで事前確認。

3. **SharePoint サイトのアクセス権**
   - テストデータ保存先となるSharePoint サイトについて、**UAT関係者に編集または閲覧のアクセス権限が付与されているか確認**する。
   - アクセスエラー発生時の対応手順を事前に整理しておくとよい。
  
   - キャンバスアプリで実装する際に必要となる、各テーブルのフィールド詳細をまとめました。各フィールドの「表示名」「内部名」「データ型」「説明」「（必要に応じた）関連先」をご確認ください。

---

## 1. Customer（顧客マスタ）

| 表示名         | 内部名             | データ型    | 説明              | 関連先 |
| ----------- | --------------- | ------- | --------------- | --- |
| Customer ID | customerid      | 単一行テキスト | 自動生成された一意の識別子   | —   |
| 氏名          | name            | 単一行テキスト | 顧客のフルネーム        | —   |
| 生年月日        | birthdate       | 日付      | 顧客の生年月日         | —   |
| メールアドレス     | email           | 電子メール   | 連絡用メールアドレス      | —   |
| 電話番号        | telephone       | 電話      | 連絡用電話番号         | —   |
| 住所          | address         | 複数行テキスト | 顧客の住所           | —   |
| KYCステータス    | new\_kycstatus  | 選択肢     | 未実施／審査中／承認済／否認  | —   |
| リスク評価       | new\_riskrating | 選択肢     | Low／Medium／High | —   |
| 登録日         | createdon       | 日時      | レコード作成日時        | —   |

---

## 2. Account（口座マスタ）

| 表示名        | 内部名              | データ型        | 説明                | 関連先                 |
| ---------- | ---------------- | ----------- | ----------------- | ------------------- |
| Account ID | accountid        | 単一行テキスト     | 自動生成された一意の識別子     | —                   |
| 顧客         | new\_customer    | 参照 (Lookup) | Customer テーブルへの参照 | Customer.customerid |
| 口座種別       | new\_accounttype | 選択肢         | 普通／当座／貯蓄          | —                   |
| 通貨         | new\_currency    | 選択肢         | JPY／USD／EUR       | —                   |
| 残高         | new\_balance     | 通貨          | 現在の口座残高           | —                   |
| 開設日        | new\_opendate    | 日付          | 口座開設日             | —                   |

---

## 3. Transaction（取引明細）

| 表示名            | 内部名           | データ型        | 説明               | 関連先               |
| -------------- | ------------- | ----------- | ---------------- | ----------------- |
| Transaction ID | transactionid | 単一行テキスト     | 自動生成された一意の識別子    | —                 |
| 口座             | new\_account  | 参照 (Lookup) | Account テーブルへの参照 | Account.accountid |
| 日付             | new\_date     | 日付          | 取引実施日            | —                 |
| 種別             | new\_type     | 選択肢         | 入金／出金            | —                 |
| 金額             | new\_amount   | 通貨          | 取引金額             | —                 |
| ステータス          | new\_status   | 選択肢         | 仮登録／完了           | —                 |
| 備考             | new\_note     | 複数行テキスト     | メモ欄              | —                 |

---

## 4. LoanApplication（ローン申請）

| 表示名            | 内部名                  | データ型        | 説明                | 関連先                 |
| -------------- | -------------------- | ----------- | ----------------- | ------------------- |
| Application ID | loanapplicationid    | 単一行テキスト     | 自動生成された一意の識別子     | —                   |
| 顧客             | new\_customer        | 参照 (Lookup) | Customer テーブルへの参照 | Customer.customerid |
| 申請金額           | new\_requestedamount | 通貨          | 顧客が希望する借入金額       | —                   |
| 返済期間(月)        | new\_termmonths      | 数値          | 返済期間（単位：月）        | —                   |
| 用途             | new\_purpose         | 単一行テキスト     | ローンの利用目的          | —                   |
| ステータス          | new\_status          | 選択肢         | 下書／提出／承認／却下       | —                   |
| 申請日            | createdon            | 日時          | レコード作成日時          | —                   |

---

## 5. ComplianceCheck（コンプライアンスチェック）

| 表示名      | 内部名                  | データ型        | 説明                       | 関連先                               |
| -------- | -------------------- | ----------- | ------------------------ | --------------------------------- |
| Check ID | new\_checkid         | 単一行テキスト     | 自動生成された一意の識別子            | —                                 |
| ローン申請    | new\_loanapplication | 参照 (Lookup) | LoanApplication テーブルへの参照 | LoanApplication.loanapplicationid |
| チェック種別   | new\_checktype       | 選択肢         | 与信／AML                   | —                                 |
| 結果       | new\_result          | 選択肢         | OK／NG                    | —                                 |
| チェック実施者  | new\_checkedby       | 単一行テキスト     | 実施者名                     | —                                 |
| チェック日    | new\_checkedon       | 日付          | チェック実施日                  | —                                 |

---

## 6. Approval（承認履歴）

| 表示名         | 内部名               | データ型      | 説明                                     | 関連先                     |
| ----------- | ----------------- | --------- | -------------------------------------- | ----------------------- |
| Approval ID | new\_approvalid   | 単一行テキスト   | 自動生成された一意の識別子                          | —                       |
| 対象エンティティ    | new\_parenttype   | 単一行テキスト   | “LoanApplication”／“Account”など対象エンティティ名 | —                       |
| 対象レコードID    | new\_parentid     | 単一行テキスト   | 対象レコードの内部 ID                           | —                       |
| 承認者         | new\_approver     | 参照 (User) | Dataverse ユーザーテーブルへの参照                 | systemuser.systemuserid |
| ステータス       | new\_status       | 選択肢       | 承認中／承認／却下                              | —                       |
| コメント        | new\_comments     | 複数行テキスト   | 承認者コメント                                | —                       |
| 決裁日         | new\_decisiondate | 日付        | 最終決裁が行われた日                             | —                       |

---

## 7. Document（ドキュメント管理）

| 表示名         | 内部名               | データ型      | 説明                             | 関連先                     |
| ----------- | ----------------- | --------- | ------------------------------ | ----------------------- |
| Document ID | new\_documentid   | 単一行テキスト   | 自動生成された一意の識別子                  | —                       |
| 関連エンティティ    | new\_relatedtype  | 単一行テキスト   | “Customer”／“LoanApplication”など | —                       |
| 関連レコードID    | new\_relatedid    | 単一行テキスト   | 対象レコードの内部 ID                   | —                       |
| 種類          | new\_documenttype | 選択肢       | 契約書／身分証／その他                    | —                       |
| ファイル        | new\_file         | 添付ファイル    | 実際のドキュメントファイル                  | —                       |
| アップロード者     | new\_uploadedby   | 参照 (User) | Dataverse ユーザーテーブルへの参照         | systemuser.systemuserid |
| アップロード日     | new\_uploadedon   | 日時        | ファイルをアップロードした日時                | —                       |

---

## 8. Case（ケース管理）

| 表示名     | 内部名              | データ型        | 説明                     | 関連先                     |
| ------- | ---------------- | ----------- | ---------------------- | ----------------------- |
| Case ID | caseid           | 単一行テキスト     | 自動生成された一意の識別子          | —                       |
| 顧客      | new\_customer    | 参照 (Lookup) | Customer テーブルへの参照      | Customer.customerid     |
| ケース種別   | new\_casetype    | 選択肢         | 問い合わせ／苦情／内部調査          | —                       |
| 内容      | new\_description | 複数行テキスト     | ケースの詳細説明               | —                       |
| ステータス   | new\_status      | 選択肢         | 未対応／対応中／完了             | —                       |
| 担当者     | new\_assignedto  | 参照 (User)   | Dataverse ユーザーテーブルへの参照 | systemuser.systemuserid |
| 作成日     | createdon        | 日時          | レコード作成日時               | —                       |

---

### キャンバスアプリでのポイント

1. **データソース接続**
   すべてのテーブルを Canvas アプリの「データ」タブから追加。
2. **ギャラリー表示**
   各エンティティ用のギャラリーを作成し、上記フィールドをバインド。
3. **フォーム画面**
   新規作成／編集用に「編集フォーム」コントロールを配置し、必要なフィールドをカード単位で表示・非表示を制御。
4. **ルックアップの扱い**
   顧客参照や承認者参照には「ドロップダウン」コントロールを使い、Items プロパティに該当データソースを設定。
5. **選択肢フィールド**
   Dataverse の選択肢は「Choices」関数で取得可能例：

   ```powerapps
   Choices(Customer.new_kycstatus)
   ```
6. **日時フィールド**
   日付入力には「日付ピッカー」コントロール、時刻付き日時には「DateTimeValue」関数でフォーマット調整。

このテーブル構成とフィールド定義をもとに、キャンバスアプリでのサンプルワークフローを組み立ててみてください！何か追加のご要望や具体的な画面構成支援があればお知らせください。


---

## 【補足情報】

- 通知・差し戻しなどはPower Appsの機能で実行、コレクションをリフレッシュし、再度構成。JSONの保存の機能を設ける想定。
- 点検項目の出力は、ApplyCategoryという値と資料区分に対して、どの項目が出力されるかFilterの仕組みを設定する。承認申請の項目が不透明であるため、確認の必要あり。
