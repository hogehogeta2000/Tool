<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power BI è£½å“åˆ†æç”¨ãƒ¡ã‚¸ãƒ£ãƒ¼&è¨­å®šå®Œå…¨ã‚¬ã‚¤ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .analysis-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 8px 12px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.8rem;
            margin: 2px;
        }
        
        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .tab.active {
            background: linear-gradient(45deg, #764ba2, #667eea);
            transform: scale(1.05);
        }
        
        .analysis-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .analysis-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
            margin-bottom: 25px;
        }
        
        .analysis-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dax-block {
            background: #1a365d;
            color: #90cdf4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border-left: 4px solid #4299e1;
            overflow-x: auto;
            line-height: 1.4;
            font-size: 0.9rem;
        }
        
        .dax-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .visual-setup {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .visual-setup h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 10px 0;
        }
        
        .setup-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }
        
        .setup-label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        
        .setup-value {
            color: #666;
            font-size: 0.85rem;
            margin-top: 3px;
        }
        
        .insights-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #155724;
        }
        
        .insights-box h4 {
            margin-bottom: 8px;
            color: #155724;
        }
        
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        
        .step-list {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }
        
        .step-list li {
            counter-increment: step-counter;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 6px;
            position: relative;
            padding-left: 40px;
            font-size: 0.9rem;
        }
        
        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 12px;
            top: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.7rem;
        }
        
        .measure-category {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .copy-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            margin-left: 10px;
            transition: background 0.3s ease;
        }
        
        .copy-button:hover {
            background: #218838;
        }
        
        .complexity-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .easy { background: #d4edda; color: #155724; }
        .medium { background: #fff3cd; color: #856404; }
        .hard { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Power BI è£½å“åˆ†æç”¨ãƒ¡ã‚¸ãƒ£ãƒ¼&è¨­å®šå®Œå…¨ã‚¬ã‚¤ãƒ‰</h1>
            <p style="color: #666; margin-top: 10px;">7ã¤ã®åˆ†æè»¸ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®è©³ç´°æ‰‹é †</p>
        </div>
        
        <div class="analysis-tabs">
            <button class="tab active" onclick="showAnalysis('risk')">ğŸ“Š ãƒªã‚¹ã‚¯åç›Šæ€§</button>
            <button class="tab" onclick="showAnalysis('age')">ğŸ‘¥ å¹´é½¢å±¤é¸å¥½</button>
            <button class="tab" onclick="showAnalysis('channel')">ğŸª ãƒãƒ£ãƒãƒ«åŠ¹ç‡</button>
            <button class="tab" onclick="showAnalysis('complexity')">âš™ï¸ è¤‡é›‘åº¦æˆç´„</button>
            <button class="tab" onclick="showAnalysis('digital')">ğŸ’» ãƒ‡ã‚¸ã‚¿ãƒ«æˆé•·</button>
            <button class="tab" onclick="showAnalysis('commission')">ğŸ’° æ‰‹æ•°æ–™è²¢çŒ®</button>
            <button class="tab" onclick="showAnalysis('portfolio')">ğŸ“ˆ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª</button>
        </div>
        
        <!-- ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¥åç›Šæ€§åˆ†æ -->
        <div id="risk" class="analysis-content active">
            <div class="analysis-card">
                <div class="analysis-title">
                    ğŸ“Š ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¥åç›Šæ€§åˆ†æ
                    <span class="complexity-indicator easy">åˆç´š</span>
                </div>
                
                <div class="measure-category">
                    <h3>åŸºæœ¬ãƒ¡ã‚¸ãƒ£ãƒ¼ï¼ˆ4å€‹ï¼‰</h3>
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 1. ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¥å¹³å‡æ‰‹æ•°æ–™ç‡</div>
ãƒªã‚¹ã‚¯åˆ¥å¹³å‡æ‰‹æ•°æ–™ç‡ = 
CALCULATE(
    AVERAGEX(
        SUMMARIZE(
            sales_performance,
            products[product_id],
            products[risk_level],
            "å•†å“æ‰‹æ•°æ–™ç‡", RELATED(products[commission_rate])
        ),
        [å•†å“æ‰‹æ•°æ–™ç‡]
    )
)
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 2. ãƒªã‚¹ã‚¯èª¿æ•´æ¸ˆã¿åç›Šç‡</div>
ãƒªã‚¹ã‚¯èª¿æ•´æ¸ˆã¿åç›Šç‡ = 
VAR ãƒªã‚¹ã‚¯ä¿‚æ•° = 
    SWITCH(
        SELECTEDVALUE(products[risk_level]),
        "ä½ãƒªã‚¹ã‚¯", 1.0,
        "ä¸­ãƒªã‚¹ã‚¯", 0.8,
        "é«˜ãƒªã‚¹ã‚¯", 0.6,
        1.0
    )
VAR ç·åç›Š = SUM(sales_performance[commission_amount])
VAR ç·å£²ä¸Š = SUM(sales_performance[amount])
RETURN
DIVIDE(ç·åç›Š, ç·å£²ä¸Š) * ãƒªã‚¹ã‚¯ä¿‚æ•° * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 3. ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¥å£²ä¸Šæ§‹æˆæ¯”</div>
ãƒªã‚¹ã‚¯åˆ¥å£²ä¸Šæ§‹æˆæ¯” = 
VAR ç¾åœ¨ã®ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        ALLEXCEPT(products, products[risk_level])
    )
VAR ç·å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        ALL(products[risk_level])
    )
RETURN
DIVIDE(ç¾åœ¨ã®ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«å£²ä¸Š, ç·å£²ä¸Š) * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 4. ãƒªã‚¹ã‚¯ãƒªã‚¿ãƒ¼ãƒ³åŠ¹ç‡æŒ‡æ¨™</div>
ãƒªã‚¹ã‚¯ãƒªã‚¿ãƒ¼ãƒ³åŠ¹ç‡ = 
VAR æ‰‹æ•°æ–™ç‡ = AVERAGEX(
    FILTER(
        products,
        products[risk_level] = SELECTEDVALUE(products[risk_level])
    ),
    products[commission_rate]
)
VAR ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ = 
    SWITCH(
        SELECTEDVALUE(products[risk_level]),
        "ä½ãƒªã‚¹ã‚¯", 1,
        "ä¸­ãƒªã‚¹ã‚¯", 2,
        "é«˜ãƒªã‚¹ã‚¯", 3,
        2
    )
RETURN
DIVIDE(æ‰‹æ•°æ–™ç‡, ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢) * 100
                </div>
                
                <div class="visual-setup">
                    <h4>ğŸ¯ æ¨å¥¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¨­å®š</h4>
                    <div class="setup-grid">
                        <div class="setup-item">
                            <div class="setup-label">ãƒ¡ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ</div>
                            <div class="setup-value">æ•£å¸ƒå›³</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">Xè»¸</div>
                            <div class="setup-value">risk_level</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">Yè»¸</div>
                            <div class="setup-value">ãƒªã‚¹ã‚¯åˆ¥å¹³å‡æ‰‹æ•°æ–™ç‡</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">ã‚µã‚¤ã‚º</div>
                            <div class="setup-value">SUM(sales_performance[amount])</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">è‰²</div>
                            <div class="setup-value">product_category</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">ã‚µãƒ–ãƒãƒ£ãƒ¼ãƒˆ</div>
                            <div class="setup-value">ãƒ‰ãƒ¼ãƒŠãƒ„ãƒãƒ£ãƒ¼ãƒˆï¼ˆãƒªã‚¹ã‚¯åˆ¥å£²ä¸Šæ§‹æˆæ¯”ï¼‰</div>
                        </div>
                    </div>
                </div>
                
                <div class="insights-box">
                    <h4>ğŸ’¡ åˆ†æã®æ´å¯Ÿ</h4>
                    <ul style="margin-left: 20px; margin-top: 8px;">
                        <li>é«˜ãƒªã‚¹ã‚¯å•†å“ã®åç›Šæ€§ãŒãƒªã‚¹ã‚¯ã«è¦‹åˆã£ã¦ã„ã‚‹ã‹è©•ä¾¡</li>
                        <li>ä½ãƒªã‚¹ã‚¯å•†å“ã®å£²ä¸Šæ§‹æˆãŒéåº¦ã«é«˜ããªã„ã‹ç¢ºèª</li>
                        <li>ãƒªã‚¹ã‚¯èª¿æ•´å¾Œã®åç›Šç‡ã§çœŸã®å•†å“ä¾¡å€¤ã‚’æ¸¬å®š</li>
                        <li>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸãƒªã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®æ§‹ç¯‰æŒ‡æ¨™</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- å¹´é½¢å±¤åˆ¥å•†å“é¸å¥½åˆ†æ -->
        <div id="age" class="analysis-content">
            <div class="analysis-card">
                <div class="analysis-title">
                    ğŸ‘¥ å¹´é½¢å±¤åˆ¥å•†å“é¸å¥½åˆ†æ
                    <span class="complexity-indicator medium">ä¸­ç´š</span>
                </div>
                
                <div class="measure-category">
                    <h3>å¹´é½¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ãƒ¡ã‚¸ãƒ£ãƒ¼ï¼ˆ5å€‹ï¼‰</h3>
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 1. å¹´é½¢å±¤åˆ¥å•†å“é¸å¥½åº¦</div>
å¹´é½¢å±¤åˆ¥é¸å¥½åº¦ = 
VAR ç¾åœ¨å•†å“ã®å¹´é½¢å±¤å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        KEEPFILTERS(customers[customer_type] = "å€‹äºº")
    )
VAR å¹´é½¢å±¤ç·å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        customers[customer_type] = "å€‹äºº",
        ALL(products)
    )
VAR å•†å“ç·å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        ALL(customers)
    )
VAR å…¨ä½“å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        ALL(customers),
        ALL(products)
    )
RETURN
DIVIDE(ç¾åœ¨å•†å“ã®å¹´é½¢å±¤å£²ä¸Š / å¹´é½¢å±¤ç·å£²ä¸Š, å•†å“ç·å£²ä¸Š / å…¨ä½“å£²ä¸Š) * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 2. ä¸–ä»£åˆ¥å•†å“æµ¸é€ç‡</div>
ä¸–ä»£åˆ¥æµ¸é€ç‡ = 
VAR å¯¾è±¡ä¸–ä»£é¡§å®¢æ•° = 
    CALCULATE(
        DISTINCTCOUNT(customers[customer_id]),
        customers[customer_type] = "å€‹äºº"
    )
VAR å•†å“åˆ©ç”¨ä¸–ä»£é¡§å®¢æ•° = 
    CALCULATE(
        DISTINCTCOUNT(sales_performance[customer_id]),
        customers[customer_type] = "å€‹äºº"
    )
RETURN
DIVIDE(å•†å“åˆ©ç”¨ä¸–ä»£é¡§å®¢æ•°, å¯¾è±¡ä¸–ä»£é¡§å®¢æ•°) * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 3. å¹´é½¢å±¤åˆ¥å¹³å‡å–å¼•é‡‘é¡</div>
å¹´é½¢å±¤åˆ¥å¹³å‡å–å¼•é¡ = 
CALCULATE(
    AVERAGEX(
        SUMMARIZE(
            sales_performance,
            sales_performance[customer_id],
            customers[customer_type],
            "é¡§å®¢åˆ¥å–å¼•é¡", SUM(sales_performance[amount])
        ),
        [é¡§å®¢åˆ¥å–å¼•é¡]
    ),
    customers[customer_type] = "å€‹äºº"
)
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 4. å•†å“å¹´é½¢é©åˆæ€§ã‚¹ã‚³ã‚¢</div>
å¹´é½¢é©åˆæ€§ã‚¹ã‚³ã‚¢ = 
VAR å•†å“ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¹´é½¢ = SELECTEDVALUE(products[target_age])
VAR å®Ÿéš›è³¼å…¥å¹´é½¢åˆ†å¸ƒ = 
    CALCULATE(
        COUNTROWS(sales_performance),
        customers[customer_type] = "å€‹äºº"
    )
VAR ãƒãƒƒãƒãƒ³ã‚°åº¦ = 
    SWITCH(
        TRUE(),
        å•†å“ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¹´é½¢ = "å…¨ä¸–ä»£", 100,
        å•†å“ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¹´é½¢ = "è‹¥å¹´å±¤" && å®Ÿéš›è³¼å…¥å¹´é½¢åˆ†å¸ƒ > 0, 90,
        å•†å“ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¹´é½¢ = "ä¸­å¹´å±¤" && å®Ÿéš›è³¼å…¥å¹´é½¢åˆ†å¸ƒ > 0, 85,
        å•†å“ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¹´é½¢ = "é«˜é½¢å±¤" && å®Ÿéš›è³¼å…¥å¹´é½¢åˆ†å¸ƒ > 0, 80,
        50
    )
RETURN ãƒãƒƒãƒãƒ³ã‚°åº¦
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 5. ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥åç›Šè²¢çŒ®</div>
ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥è²¢çŒ®åº¦ = 
VAR ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸åŒºåˆ† = 
    SWITCH(
        SELECTEDVALUE(products[target_age]),
        "è‹¥å¹´å±¤", "æˆé•·æœŸ",
        "ä¸­å¹´å±¤", "å®‰å®šæœŸ", 
        "é«˜é½¢å±¤", "æˆç†ŸæœŸ",
        "å…¨ä¸–ä»£", "å…¨æœŸé–“",
        "ãã®ä»–"
    )
VAR ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥åç›Š = 
    CALCULATE(
        SUM(sales_performance[commission_amount]),
        customers[customer_type] = "å€‹äºº"
    )
VAR ç·åç›Š = 
    CALCULATE(
        SUM(sales_performance[commission_amount]),
        ALL(products[target_age])
    )
RETURN
DIVIDE(ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥åç›Š, ç·åç›Š) * 100
                </div>
                
                <div class="visual-setup">
                    <h4>ğŸ¯ æ¨å¥¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¨­å®š</h4>
                    <div class="setup-grid">
                        <div class="setup-item">
                            <div class="setup-label">ãƒ¡ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ</div>
                            <div class="setup-value">ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆãƒãƒˆãƒªãƒƒã‚¯ã‚¹ï¼‰</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">è¡Œ</div>
                            <div class="setup-value">products[target_age]</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">åˆ—</div>
                            <div class="setup-value">products[product_category]</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">å€¤</div>
                            <div class="setup-value">å¹´é½¢å±¤åˆ¥é¸å¥½åº¦</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">æ¡ä»¶ä»˜ãæ›¸å¼</div>
                            <div class="setup-value">ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé’â†’èµ¤ï¼‰</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">ã‚µãƒ–ãƒãƒ£ãƒ¼ãƒˆ</div>
                            <div class="setup-value">è¤‡åˆãƒãƒ£ãƒ¼ãƒˆï¼ˆæµ¸é€ç‡+å–å¼•é¡ï¼‰</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è²©å£²ãƒãƒ£ãƒãƒ«åˆ¥åŠ¹ç‡æ€§åˆ†æ -->
        <div id="channel" class="analysis-content">
            <div class="analysis-card">
                <div class="analysis-title">
                    ğŸª è²©å£²ãƒãƒ£ãƒãƒ«åˆ¥åŠ¹ç‡æ€§åˆ†æ
                    <span class="complexity-indicator medium">ä¸­ç´š</span>
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 1. ãƒãƒ£ãƒãƒ«åˆ¥æˆç´„ç‡</div>
ãƒãƒ£ãƒãƒ«åˆ¥æˆç´„ç‡ = 
VAR ãƒãƒ£ãƒãƒ«åˆ¥å–å¼•æ•° = 
    CALCULATE(
        DISTINCTCOUNT(sales_performance[transaction_id])
    )
VAR ãƒãƒ£ãƒãƒ«åˆ¥è¦‹è¾¼æ•° = ãƒãƒ£ãƒãƒ«åˆ¥å–å¼•æ•° * 2.5 // æƒ³å®šã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‡40%
RETURN
DIVIDE(ãƒãƒ£ãƒãƒ«åˆ¥å–å¼•æ•°, ãƒãƒ£ãƒãƒ«åˆ¥è¦‹è¾¼æ•°) * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 2. ãƒãƒ£ãƒãƒ«åˆ¥åŠ¹ç‡æŒ‡æ¨™</div>
ãƒãƒ£ãƒãƒ«åŠ¹ç‡æŒ‡æ¨™ = 
VAR ãƒãƒ£ãƒãƒ«åˆ¥å£²ä¸Š = SUM(sales_performance[amount])
VAR ãƒãƒ£ãƒãƒ«åˆ¥å–å¼•æ•° = DISTINCTCOUNT(sales_performance[transaction_id])
VAR åŠ¹ç‡æ€§ = DIVIDE(ãƒãƒ£ãƒãƒ«åˆ¥å£²ä¸Š, ãƒãƒ£ãƒãƒ«åˆ¥å–å¼•æ•°)
VAR ãƒãƒ£ãƒãƒ«ã‚³ã‚¹ãƒˆä¿‚æ•° = 
    SWITCH(
        SELECTEDVALUE(products[sales_channel]),
        "å…¨ãƒãƒ£ãƒãƒ«", 1.0,
        "å–¶æ¥­æ‹…å½“è€…", 1.8,
        "åº—èˆ—ãƒ»å–¶æ¥­", 1.5,
        "å–¶æ¥­ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³", 1.2,
        "å–¶æ¥­ãƒ»åº—èˆ—", 1.4,
        1.0
    )
RETURN
DIVIDE(åŠ¹ç‡æ€§, ãƒãƒ£ãƒãƒ«ã‚³ã‚¹ãƒˆä¿‚æ•°)
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 3. ãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒ£ãƒãƒ«æˆé•·ç‡</div>
ãƒ‡ã‚¸ã‚¿ãƒ«æˆé•·ç‡ = 
VAR ä»ŠæœŸãƒ‡ã‚¸ã‚¿ãƒ«å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        products[is_digital] = TRUE,
        DATESINPERIOD(
            sales_performance[transaction_date],
            MAX(sales_performance[transaction_date]),
            -3,
            MONTH
        )
    )
VAR å‰æœŸãƒ‡ã‚¸ã‚¿ãƒ«å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        products[is_digital] = TRUE,
        DATESINPERIOD(
            sales_performance[transaction_date],
            MAX(sales_performance[transaction_date]) - 90,
            -3,
            MONTH
        )
    )
RETURN
DIVIDE(ä»ŠæœŸãƒ‡ã‚¸ã‚¿ãƒ«å£²ä¸Š - å‰æœŸãƒ‡ã‚¸ã‚¿ãƒ«å£²ä¸Š, å‰æœŸãƒ‡ã‚¸ã‚¿ãƒ«å£²ä¸Š) * 100
                </div>
            </div>
        </div>
        
        <!-- å•†å“è¤‡é›‘åº¦åˆ¥æˆç´„ç‡åˆ†æ -->
        <div id="complexity" class="analysis-content">
            <div class="analysis-card">
                <div class="analysis-title">
                    âš™ï¸ å•†å“è¤‡é›‘åº¦åˆ¥æˆç´„ç‡åˆ†æ
                    <span class="complexity-indicator hard">ä¸Šç´š</span>
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 1. è¤‡é›‘åº¦åˆ¥æˆç´„ç‡</div>
è¤‡é›‘åº¦åˆ¥æˆç´„ç‡ = 
VAR è¤‡é›‘åº¦ = SELECTEDVALUE(products[complexity])
VAR è¤‡é›‘åº¦åˆ¥å–å¼•æ•° = 
    CALCULATE(
        DISTINCTCOUNT(sales_performance[transaction_id])
    )
VAR åŸºæº–æˆç´„ç‡ = 
    SWITCH(
        è¤‡é›‘åº¦,
        "ã‚·ãƒ³ãƒ—ãƒ«", 0.65,
        "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", 0.45, 
        "è¤‡é›‘", 0.25,
        0.45
    )
VAR å®Ÿéš›æˆç´„æ•° = è¤‡é›‘åº¦åˆ¥å–å¼•æ•°
VAR æƒ³å®šå•†è«‡æ•° = DIVIDE(å®Ÿéš›æˆç´„æ•°, åŸºæº–æˆç´„ç‡)
RETURN
DIVIDE(å®Ÿéš›æˆç´„æ•°, æƒ³å®šå•†è«‡æ•°) * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 2. è¤‡é›‘åº¦ã‚³ã‚¹ãƒˆåŠ¹ç‡</div>
è¤‡é›‘åº¦ã‚³ã‚¹ãƒˆåŠ¹ç‡ = 
VAR å£²ä¸Šé«˜ = SUM(sales_performance[amount])
VAR è¤‡é›‘åº¦ä¿‚æ•° = 
    SWITCH(
        SELECTEDVALUE(products[complexity]),
        "ã‚·ãƒ³ãƒ—ãƒ«", 1.0,
        "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", 1.3,
        "è¤‡é›‘", 1.8,
        1.0
    )
RETURN
DIVIDE(å£²ä¸Šé«˜, è¤‡é›‘åº¦ä¿‚æ•°)
                </div>
            </div>
        </div>
        
        <!-- ãƒ‡ã‚¸ã‚¿ãƒ«å¯¾å¿œå•†å“ã®æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰ -->
        <div id="digital" class="analysis-content">
            <div class="analysis-card">
                <div class="analysis-title">
                    ğŸ’» ãƒ‡ã‚¸ã‚¿ãƒ«å¯¾å¿œå•†å“ã®æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰
                    <span class="complexity-indicator easy">åˆç´š</span>
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 1. ãƒ‡ã‚¸ã‚¿ãƒ«å•†å“æˆé•·ç‡</div>
ãƒ‡ã‚¸ã‚¿ãƒ«å•†å“æˆé•·ç‡ = 
VAR ä»Šæœˆå£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        products[is_digital] = TRUE,
        DATESMTD(sales_performance[transaction_date])
    )
VAR å‰æœˆå£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        products[is_digital] = TRUE,
        PREVIOUSMONTH(sales_performance[transaction_date])
    )
RETURN
DIVIDE(ä»Šæœˆå£²ä¸Š - å‰æœˆå£²ä¸Š, å‰æœˆå£²ä¸Š) * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 2. ãƒ‡ã‚¸ã‚¿ãƒ«æµ¸é€ç‡</div>
ãƒ‡ã‚¸ã‚¿ãƒ«æµ¸é€ç‡ = 
VAR ãƒ‡ã‚¸ã‚¿ãƒ«å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        products[is_digital] = TRUE
    )
VAR ç·å£²ä¸Š = SUM(sales_performance[amount])
RETURN
DIVIDE(ãƒ‡ã‚¸ã‚¿ãƒ«å£²ä¸Š, ç·å£²ä¸Š) * 100
                </div>
            </div>
        </div>
        
        <!-- æ‰‹æ•°æ–™ç‡åˆ¥å£²ä¸Šè²¢çŒ®åº¦åˆ†æ -->
        <div id="commission" class="analysis-content">
            <div class="analysis-card">
                <div class="analysis-title">
                    ğŸ’° æ‰‹æ•°æ–™ç‡åˆ¥å£²ä¸Šè²¢çŒ®åº¦åˆ†æ
                    <span class="complexity-indicator medium">ä¸­ç´š</span>
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 1. æ‰‹æ•°æ–™ç‡ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†é¡</div>
æ‰‹æ•°æ–™ç‡ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ = 
VAR æ‰‹æ•°æ–™ç‡ = RELATED(products[commission_rate])
RETURN
SWITCH(
    TRUE(),
    æ‰‹æ•°æ–™ç‡ <= 1.0, "ä½æ‰‹æ•°æ–™ï¼ˆï½1.0%ï¼‰",
    æ‰‹æ•°æ–™ç‡ <= 3.0, "ä¸­æ‰‹æ•°æ–™ï¼ˆ1.1-3.0%ï¼‰",
    æ‰‹æ•°æ–™ç‡ > 3.0, "é«˜æ‰‹æ•°æ–™ï¼ˆ3.1%ï½ï¼‰",
    "æœªåˆ†é¡"
)
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 2. æ‰‹æ•°æ–™åŠ¹ç‡æŒ‡æ¨™</div>
æ‰‹æ•°æ–™åŠ¹ç‡æŒ‡æ¨™ = 
VAR æ‰‹æ•°æ–™åå…¥ = SUM(sales_performance[commission_amount])
VAR å£²ä¸Šé«˜ = SUM(sales_performance[amount])
VAR å–å¼•ä»¶æ•° = DISTINCTCOUNT(sales_performance[transaction_id])
RETURN
DIVIDE(æ‰‹æ•°æ–™åå…¥, å–å¼•ä»¶æ•°)
                </div>
            </div>
        </div>
        
        <!-- é¡§å®¢ã‚¿ã‚¤ãƒ—åˆ¥å•†å“ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªåˆ†æ -->
        <div id="portfolio" class="analysis-content">
            <div class="analysis-card">
                <div class="analysis-title">
                    ğŸ“ˆ é¡§å®¢ã‚¿ã‚¤ãƒ—åˆ¥å•†å“ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªåˆ†æ
                    <span class="complexity-indicator hard">ä¸Šç´š</span>
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 1. é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥å•†å“é›†ä¸­åº¦</div>
å•†å“é›†ä¸­åº¦ = 
VAR é¡§å®¢ã‚¿ã‚¤ãƒ—åˆ¥å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        ALLEXCEPT(customers, customers[customer_type])
    )
VAR ç·å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        ALL(customers[customer_type])
    )
VAR å•†å“åˆ¥å£²ä¸Š = SUM(sales_performance[amount])
VAR å•†å“ç·å£²ä¸Š = 
    CALCULATE(
        SUM(sales_performance[amount]),
        ALL(products)
    )
RETURN
(DIVIDE(å•†å“åˆ¥å£²ä¸Š, é¡§å®¢ã‚¿ã‚¤ãƒ—åˆ¥å£²ä¸Š) / DIVIDE(å•†å“ç·å£²ä¸Š, ç·å£²ä¸Š)) * 100
                </div>
                
                <div class="dax-block">
                    <div class="dax-title">// 2. ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢</div>
ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒãƒ©ãƒ³ã‚¹ = 
VAR å€‹äººå‘ã‘å£²ä¸Šæ¯”ç‡ = 
    CALCULATE(
        SUM(sales_performance[amount]),
        customers[customer_type] = "å€‹äºº"
    ) / SUM(sales_performance[amount])
VAR æ³•äººå‘ã‘å£²ä¸Šæ¯”ç‡ = 
    CALCULATE(
        SUM(sales_performance[amount]),
        customers[customer_type] = "æ³•äºº"
    ) / SUM(sales_performance[amount])
VAR ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢ = 100 - ABS(å€‹äººå‘ã‘å£²ä¸Šæ¯”ç‡ - æ³•äººå‘ã‘å£²ä¸Šæ¯”ç‡) * 100
RETURN ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢
                </div>
            </div>
        </div>
        
        <div class="warning-box">
            <h4>âš ï¸ å®Ÿè£…æ™‚ã®æ³¨æ„äº‹é …</h4>
            <ol class="step-list">
                <li>æœ€åˆã«åŸºæœ¬çš„ãªãƒ¡ã‚¸ãƒ£ãƒ¼ã‹ã‚‰å®Ÿè£…ã—ã€å‹•ä½œç¢ºèªã—ã¦ã‹ã‚‰è¤‡é›‘ãªãƒ¡ã‚¸ãƒ£ãƒ¼ã«é€²ã‚€</li>
                <li>ãƒ‡ãƒ¼ã‚¿ã®å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆNULLå€¤ã€ç•°å¸¸å€¤ã®å‡¦ç†ï¼‰ã‚’äº‹å‰ã«å®Ÿæ–½</li>
                <li>ãƒ¡ã‚¸ãƒ£ãƒ¼ã®è¨ˆç®—çµæœãŒæƒ³å®šç¯„å›²å†…ã‹ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼</li>
                <li>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ï¼ˆè¤‡é›‘ãªãƒ¡ã‚¸ãƒ£ãƒ¼ã¯è¨ˆç®—æ™‚é–“ãŒé•·ããªã‚‹å¯èƒ½æ€§ï¼‰</li>
                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åé›†ã—ã¦æ®µéšçš„ã«æ”¹å–„</li>
            </ol>
        </div>
        
        <div class="insights-box">
            <h4>ğŸš€ å®Ÿè£…å„ªå…ˆé †ä½ã®æ¨å¥¨</h4>
            <p><strong>1ä½:</strong> ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¥åç›Šæ€§åˆ†æï¼ˆãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆå¤§ï¼‰<br>
            <strong>2ä½:</strong> ãƒ‡ã‚¸ã‚¿ãƒ«å¯¾å¿œå•†å“æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆæˆ¦ç•¥çš„é‡è¦æ€§ï¼‰<br>
            <strong>3ä½:</strong>è²©å£²ãƒãƒ£ãƒãƒ«åˆ¥åŠ¹ç‡æ€§åˆ†æï¼ˆé‹å–¶æ”¹å–„åŠ¹æœï¼‰<br>
            <strong>4ä½:</strong> æ‰‹æ•°æ–™ç‡åˆ¥å£²ä¸Šè²¢çŒ®åº¦åˆ†æï¼ˆåç›Šæœ€é©åŒ–ï¼‰<br>
            <strong>5ä½:</strong> å¹´é½¢å±¤åˆ¥å•†å“é¸å¥½åˆ†æï¼ˆãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥ï¼‰</p>
        </div>
    </div>
    
    <script>
        function showAnalysis(analysisId) {
            // å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            const contents = document.querySelectorAll('.analysis-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // å…¨ã¦ã®ã‚¿ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // æŒ‡å®šã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
            document.getElementById(analysisId).classList.add('active');
            
            // å¯¾å¿œã™ã‚‹ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            event.target.classList.add('active');
        }
        
        // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
        function copyDAX(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('DAXãŒã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼');
            });
        }
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.analysis-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>
