# ワークフロー通知設計書

## 1. システム概要
### 1.1 システム名
ワークフロー通知システム

### 1.2 システムの目的
本システムは、ワークフローの各フェーズにおける進捗を関係者に通知し、スムーズな業務遂行を支援することを目的とする。通知手段としてPower Automateを利用し、適切なタイミングで関係者に情報を提供する。通知の内容や送信先は、ワークフローのアクションごとに異なる。

### 1.3 システム構成
- **ワークフロー管理システム**（既存）
- **Power Automate（クラウドフローを使用したメール送信）**
- **データストレージ**（SharePoint Lists、Dataverse など）

## 2. 通知要件
### 2.1 通知内容と送信先
| No | アクション | メールの内容 | 送信先 | ボタンの活性/非活性 |
|----|-----------|--------------|--------|----------------|
| 1 | 承認依頼 | 申請内容を表示し、承認/却下ボタンを設置 | 承認者 | 承認・却下ボタンを活性化 |
| 2 | 承認完了 | 申請者に結果を通知し、次のアクションへのリンクを提供 | 申請者 | 関連タスクがある場合ボタンを活性化 |
| 3 | 期限リマインド | 承認者に承認待ちの申請を通知し、期限を強調 | 承認者 | 承認・却下ボタンを活性化 |
| 4 | 差し戻し | 申請者に差し戻し理由を通知し、修正ボタンを提供 | 申請者 | 修正ボタンを活性化 |
| 5 | 設定変更 | 関係者に変更内容を通知し、影響のある項目を強調 | 関係者 | 影響範囲がある場合のみボタンを活性化 |

### 2.2 非機能要件
- **可用性**：99.9%以上の稼働率
- **拡張性**：新しいワークフロー追加時に容易に対応できる設計
- **セキュリティ**：メールの誤送信防止、アクセス制限の設定

## 3. メールテンプレート
| No | メール種別 | 件名 | 本文（概要） | 送信先 |
|----|-----------|------|--------------|--------|
| 1 | 承認依頼 | [申請名] 承認依頼 | 申請内容の詳細と承認リンク | 承認者 |
| 2 | 承認完了 | [申請名] 承認完了 | 承認の結果と次のアクション | 申請者 |
| 3 | 期限リマインド | [申請名] 承認期限通知 | 期限が近づいている旨を通知 | 承認者 |
| 4 | 差し戻し | [申請名] 差し戻し通知 | 差し戻し理由と再申請の案内 | 申請者 |
| 5 | 設定変更 | [システム名] 設定変更通知 | 変更内容の詳細 | 関係者 |

メールテンプレートは、用途に応じたバリエーションを用意し、ユーザー体験を向上させる。

## 4. システム運用
### 4.1 監視と保守
- Power Automate のエラーハンドリング（送信失敗時のリトライ）
- 通知ログは Power Automate の履歴を利用し、追加の保存は不要
- システム更新時の影響確認

### 4.2 エラー対応
| エラー種別 | 対応策 |
|-----------|--------|
| メール送信失敗 | リトライ、管理者通知 |
| 承認者未設定 | 申請者へエラー通知 |
| システム障害 | 代替手段（手動通知） |

## 5. セキュリティ対策
- **誤送信防止**：事前に送信先アドレスを確認
- **アクセス制限**：通知システムへのアクセス管理

## 6. まとめ
本システムは、ワークフローの進捗をスムーズに通知し、関係者が適切なアクションを迅速に取れるように設計されている。メールのテンプレートを柔軟に設計し、Power Automate の機能を最大限活用することで、簡潔かつ効率的な運用を目指す。

